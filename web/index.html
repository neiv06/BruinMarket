<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Media Upload</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; padding: 24px; }
    .card { max-width: 720px; margin: 0 auto; padding: 20px; border: 1px solid #e5e7eb; border-radius: 8px; }
    h1 { font-size: 20px; margin: 0 0 12px; }
    .row { display: flex; gap: 8px; align-items: center; }
    input[type="file"] { margin: 12px 0; }
    button { padding: 8px 12px; border: none; border-radius: 6px; background: #2563eb; color: white; cursor: pointer; }
    button:disabled { background: #9ca3af; cursor: not-allowed; }
    .status { margin-top: 12px; min-height: 20px; color: #111827; }
    .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px; margin-top: 16px; }
    .item { border: 1px solid #e5e7eb; border-radius: 8px; padding: 8px; }
    img, video { width: 100%; height: 140px; object-fit: cover; border-radius: 6px; }
  </style>
  <script>
    async function uploadSelected() {
      const input = document.getElementById('file');
      const status = document.getElementById('status');
      const btn = document.getElementById('btn');
      status.textContent = '';

      if (!input.files || !input.files[0]) {
        status.textContent = 'Please choose a file.';
        return;
      }

      const file = input.files[0];
      const isVideo = file.type && file.type.startsWith('video/');
      const endpoint = isVideo ? '/api/upload/video' : '/api/upload/image';

      const form = new FormData();
      form.append(isVideo ? 'video' : 'image', file);

      btn.disabled = true;
      status.textContent = 'Uploading...';

      try {
        const res = await fetch(endpoint, { method: 'POST', body: form });
        if (!res.ok) {
          const text = await res.text();
          throw new Error(text || `Upload failed: ${res.status}`);
        }
        const data = await res.json();
        const url = data.url;
        addToGallery(url, isVideo);
        status.textContent = 'Upload complete.';
        input.value = '';
      } catch (err) {
        status.textContent = 'Error: ' + err.message;
      } finally {
        btn.disabled = false;
      }
    }

    function fullUrl(path) {
      if (!path) return '';
      if (path.startsWith('http')) return path;
      return path; // same-origin (backend serves this page)
    }

    function addToGallery(url, isVideo) {
      const gallery = document.getElementById('gallery');
      const card = document.createElement('div');
      card.className = 'item';
      if (isVideo) {
        const vid = document.createElement('video');
        vid.controls = true;
        vid.src = fullUrl(url);
        card.appendChild(vid);
      } else {
        const img = document.createElement('img');
        img.alt = 'Uploaded image';
        img.src = fullUrl(url);
        card.appendChild(img);
      }
      const link = document.createElement('a');
      link.href = fullUrl(url);
      link.textContent = 'Open';
      link.target = '_blank';
      link.style.display = 'block';
      link.style.marginTop = '6px';
      card.appendChild(link);
      gallery.prepend(card);
    }
  </script>
</head>
<body>
  <div class="card">
    <h1>Upload media</h1>
    <div class="row">
      <input id="file" type="file" accept="image/*,video/*" />
      <button id="btn" onclick="uploadSelected()">Upload</button>
    </div>
    <div id="status" class="status"></div>
    <div id="gallery" class="gallery"></div>
  </div>
</body>
</html>


